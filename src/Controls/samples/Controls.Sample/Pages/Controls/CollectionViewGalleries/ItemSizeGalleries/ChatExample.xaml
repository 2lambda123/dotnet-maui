<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:chat="clr-namespace:Maui.Controls.Sample.Pages.CollectionViewGalleries.ItemSizeGalleries"
             x:DataType="chat:ChatExampleViewModel"
             x:Class="Maui.Controls.Sample.Pages.CollectionViewGalleries.ItemSizeGalleries.ChatExample">
    <ContentPage.Resources>
        <ResourceDictionary>
            <DataTemplate x:Key="Local" x:DataType="chat:ChatMessage">
                <Grid ColumnDefinitions="*,2*">
                    <Border Background="LightGreen" Grid.Column="1" Padding="2">
                        <Label Text="{Binding Text}" LineBreakMode="WordWrap" FontSize="10" HorizontalTextAlignment="End" />
                    </Border>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="Remote"  x:DataType="chat:ChatMessage">
                <Grid Padding="5,0,5,0" ColumnDefinitions="2*,*">
                    <Border Background="LightBlue" Padding="2">
                        <Label Text="{Binding Text}" LineBreakMode="WordWrap" FontSize="10" HorizontalTextAlignment="Start" />
                    </Border>
                </Grid>
            </DataTemplate>

            <chat:ChatTemplateSelector x:Key="ChatTemplateSelector"
                LocalTemplate="{StaticResource Local}"
                RemoteTemplate="{StaticResource Remote}"/>
            
        </ResourceDictionary>
    </ContentPage.Resources>

    <ContentPage.Content>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <HorizontalStackLayout Grid.Row="0">
                <Button x:Name="AppendRandomSizedItem" Text="Append Random Message" Margin="2" />
                <Button x:Name="Clear" Text="Clear" Margin="2" />
                <Button x:Name="Lots" Text="Add 1000 Messages" Margin="2" />
            </HorizontalStackLayout>

            <!-- ItemTemplate="{StaticResource ChatTemplateSelector}" -->
            <CollectionView Background="Cyan" ItemsSource="{Binding ChatMessages}" 
                            ItemTemplate="{StaticResource ChatTemplateSelector}"
                            ItemSizingStrategy="MeasureAllItems"
                            Grid.Row="1">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="5"/>
                </CollectionView.ItemsLayout>
                <!-- CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="chat:ChatMessage">
                        <Grid Padding="5,0,5,0" ColumnDefinitions="2*,*">
                            <Border Background="LightBlue" Padding="2">
                                <Label Text="{Binding Text}" LineBreakMode="WordWrap" FontSize="10" HorizontalTextAlignment="Start" />
                            </Border>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate -->
            </CollectionView>

        </Grid>
    </ContentPage.Content>
</ContentPage>