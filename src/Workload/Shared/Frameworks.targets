<Project>

  <PropertyGroup Condition=" '$(MauiPlatformName)' != '' ">
    <!-- NOTE: $(MauiPlatformName) is expected to be passed in: android, maccatalyst, ios, win-x86, win-x64, or win-arm64 -->
    <PackageId>$(PackageId).$(MauiPlatformName)</PackageId>
    <!-- If $(MauiPlatformName) is a $(RuntimeIdentifier), use /publish/ -->
    <OutputPathSuffix Condition=" $(MauiPlatformName.Contains('-')) ">$(MauiPlatformName)/publish/</OutputPathSuffix>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(MauiPlatformName)' == '' ">
    <IsPackable>false</IsPackable>
  </PropertyGroup>

  <ItemGroup>
    <_TargetPlatform
        Condition=" '$(MauiPlatformName)' == 'any' "
        Include="net$(_MauiDotNetVersion)"
        FullTfm="%(Identity)"
        Tfm="net$(_MauiDotNetVersion)"
    />
    <_TargetPlatform
        Condition=" $(MauiPlatformName.StartsWith('android')) "
        Include="net$(_MauiDotNetVersion)-android$(AndroidTargetFrameworkVersion)"
        FullTfm="%(Identity)"
        Tfm="net$(_MauiDotNetVersion)-android"
        Profile="Android"
    />
    <_TargetPlatform
        Condition=" $(MauiPlatformName.StartsWith('ios')) "
        Include="net$(_MauiDotNetVersion)-ios$(IosTargetFrameworkVersion)"
        FullTfm="%(Identity)"
        Tfm="net$(_MauiDotNetVersion)-ios"
        Profile="iOS"
    />
    <_TargetPlatform
        Condition=" $(MauiPlatformName.StartsWith('maccatalyst')) "
        Include="net$(_MauiDotNetVersion)-maccatalyst$(MacCatalystTargetFrameworkVersion)"
        FullTfm="%(Identity)"
        Tfm="net$(_MauiDotNetVersion)-maccatalyst"
        Profile="MacCatalyst"
    />
    <_TargetPlatform
        Condition=" $(MauiPlatformName.StartsWith('win')) "
        Include="net$(_MauiDotNetVersion)-windows$(WindowsTargetFrameworkVersion)"
        FullTfm="%(Identity)"
        Tfm="net$(_MauiDotNetVersion)-windows$(WindowsTargetFrameworkVersion)"
        Profile="Windows"
    />
    <_TargetPlatform
        Condition=" $(MauiPlatformName.StartsWith('tizen')) "
        Include="net$(_MauiDotNetVersion)-tizen$(TizenTargetFrameworkVersion)"
        FullTfm="%(Identity)"
        Tfm="net$(_MauiDotNetVersion)-tizen"
        Profile="Tizen"
    />
  </ItemGroup>

  <Import Condition=" '$(MauiPlatformName)' != '' " Project="FrameworkList.targets" />

  <ItemGroup>
    <_Platforms Include="any;android;maccatalyst;ios" />
    <_Platforms Include="tizen" Condition="'$(IncludeTizenTargetFrameworks)' == 'true'" />
    <!-- NOTE: we leave out "win" on purpose, they are explicitly built per-RID -->
  </ItemGroup>

  <Target Name="_PackPerPlatform" Condition=" '$(MauiPlatformName)' == '' " AfterTargets="Build">
    <ItemGroup>
      <_RIDs Include="$(WindowsMauiRuntimeIdentifiers)" />
      <_Project Include="$(MSBuildProjectFullPath)" AdditionalProperties="MauiPlatformName=%(_Platforms.Identity)" />
      <!-- Windows runtime packs for each RID -->
      <_Project
          Condition=" '$(IncludeWindowsTargetFrameworks)' == 'true' and $(MSBuildProjectName.Contains('.Runtime')) "
          Include="$(MSBuildProjectFullPath)"
          AdditionalProperties="MauiPlatformName=%(_RIDs.Identity)"
      />
      <_Project
          Condition=" '$(IncludeWindowsTargetFrameworks)' == 'true' and !$(MSBuildProjectName.Contains('.Runtime')) "
          Include="$(MSBuildProjectFullPath)"
          AdditionalProperties="MauiPlatformName=win"
      />
    </ItemGroup>
    <MSBuild
        Projects="@(_Project)"
        Targets="Pack"
        BuildInParallel="$(BuildInParallel)"
    />
  </Target>

</Project>